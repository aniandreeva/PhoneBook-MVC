@model PhoneBook.ViewModels.Contacts.ContactsEditVM

@{
    ViewBag.Title = Model.ID==0? "Create" : "Edit";
}

<h2>@ViewBag.Title</h2>


@using (Html.BeginForm("Edit", "Contacts", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        @Html.HiddenFor(model => model.ID)
        @Html.HiddenFor(model => model.UserID)
        @Html.HiddenFor(model => model.ImagePath)
        <div class="row">
            <div class="col-sm-4">
                <div class="form-group">
                    <img src="~/Uploads/@Model.ImagePath" alt="Imagine you have a photo :D" class="contact-photo" />


                    <div class="col-md-10">
                        @Html.TextBoxFor(model => model.ImageUpload, new { htmlAttributes = new { @class = "form-control", @id="image-upload" }, type = "file" })
                        @Html.ValidationMessageFor(model => model.ImageUpload, "", new { @class = "text-danger" })
                    </div>
                    <input type="button" class="delete-image" data-contactId="@Model.ID" value="Delete"/>
                </div>
            </div>

            <div class="col-sm-8">
                <div class="form-group">
                    @Html.LabelFor(model => model.FirstName, htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.FirstName, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.FirstName, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.LastName, htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.LastName, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.LastName, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Address, htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Address, new { htmlAttributes = new { @class = "form-control" } })
                        @Html.ValidationMessageFor(model => model.Address, "", new { @class = "text-danger" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Groups, htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @foreach (var group in Model.Groups)
                {
                            <input type="checkbox" name="SelectedGroups" value="@group.Value" id="@group.Value" @Html.Raw(group.Selected ? "checked" : String.Empty) />
                            <label for="@group.Value">@group.Text</label>
                        }
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="submit" value="Save" class="btn btn-default" />
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Back to List", "List")
</div>
@section scripts{
    <script>
        $('.delete-image').click(function () {
            var contactImage = $(".contact-photo");

            $.ajax({
                type: "Post",
                url: '@Url.Action("DeleteImage", "Contacts")',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ contactId: $(this).attr('data-contactId')}),
                dataType: "json",
                success: function () { contactImage.attr("src", "/Uploads/default.jpg") },
                error: function () { alert('Something went wrong... !'); }
            });
        });
    </script>
    }

